# ソフトウェアアーキテクチャの基礎

## アーキテクチャスタイル

アーキテクチャパターンともいう。

### 基礎的なパターン

例えば「レイヤー」の概念は古くから存在する。

- 巨大な泥団子 / Big Ball of Mud
  - アーキテクチャ構造が存在しないクソコードのこと
  - 現実世界で非常によく見られる
- 1 層アーキテクチャ(ユニタリーアーキテクチャ)
  - ただ 1 つのコンピューターとその上で動くソフトウェア
  - コンピューター黎明期のメインフレームなど
  - 現代にはあまり存在しない
- 2 層アーキテクチャ(クライアント・サーバー)
  - デスクトップアプリ + DB サーバー (Access とか)
  - ブラウザ + Web サーバー (現代)
- 3 層アーキテクチャ
  - JS フロントエンド + アプリケーションサーバー + 強力な商用 DB サーバー (Java とか)
  - 90 年代後半に流行った

### モノリシック vs 分散

- モノリシック
  - レイヤードアーキテクチャ
  - パイプラインアーキテクチャ
  - マイクロカーネルアーキテクチャ
- 分散
  - サービスベースアーキテクチャ
  - イベント駆動アーキテクチャ
  - スペースベースアーキテクチャ
  - サービス指向アーキテクチャ
  - マイクロサービスアーキテクチャ

分散アーキテクチャは強力だが、以下のような問題に対処する必要があり、大きなトレードオフである。

- ネットワークは信頼できない
  - タイムアウトやサーキットブレーカーのような機構が必要になる
- レイテンシーが大きい
  - ローカル呼び出しならナノ秒、RPC などはミリ秒
  - ロングテールレイテンシー(95-99%タイルのレイテンシー)を知っておくことが大事
- 帯域幅は有限である
  - GraphQL のような必要最低限のデータを取得する仕組みがないと、あっという間に食いつぶす
- ネットワークは安全ではない
  - 攻撃を受ける表面積は飛躍的に増えるので、高度なセキュリティ対策が必要になる
- ネットワークトポロジー（接続形態）は常に変化する
  - ちょっとした機器の更新がレイテンシーに影響を与えてタイムアウトを引き起こすようになるなど
- ネットワーク管理者はたくさんいる
  - コミュニケーションを取るべき管理者は実は一人ではなくたくさんいる
- 転送コストがかかる
  - レイテンシーの話ではなく RESTful 呼び出しにかかる費用の話
  - モノリスと比べるとかなり高い
- ネットワークにはムラがある
  - ネットワーク内には違うメーカーの機器が存在するし、それらが協調してうまく動く保証はない
- ロギングが難しい
  - 分散ロギングしないと問題の追跡ができない
- トランザクションが難しい
  - 分散トランザクションにより結果整合性を担保する必要がある
  - ACID トランザクションのように即時の一貫性は保証できない
